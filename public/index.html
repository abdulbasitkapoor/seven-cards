<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 Cards Online</title>
    <style>
        /* DESIGN: Classic Green Felt Table */
        body { background: #1a472a; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        #setup, #game { padding: 20px; }
        
        /* CARD STYLING */
        .card { 
            background: white; color: black; padding: 15px; margin: 8px; 
            border-radius: 10px; display: inline-block; cursor: pointer; 
            font-weight: bold; min-width: 50px; box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            border: 2px solid #ccc;
        }
        .card:hover { transform: translateY(-5px); border-color: #fbff00; }
        .red { color: #d12d2d; }
        
        /* UI ELEMENTS */
        .status-bar { background: rgba(0,0,0,0.3); padding: 10px; margin-bottom: 20px; border-radius: 8px; }
        .penalty-glow { color: #ffeb3b; font-weight: bold; }

        /* MODALS */
        #suitModal { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: #fff; color: #333; padding: 30px; border-radius: 15px; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8); display: none; z-index: 100;
        }
        button { padding: 12px 24px; margin: 10px; cursor: pointer; border-radius: 5px; border: none; font-weight: bold; }
        .btn-join { background: #2ecc71; color: white; }
        .btn-draw { background: #e67e22; color: white; }
    </style>
</head>
<body>

    <div id="setup">
        <h1>üÉè 7 Cards</h1>
        <p>Enter a name and room code to start</p>
        <input id="nameInput" type="text" placeholder="Your Name" style="padding:10px;">
        <input id="roomInput" type="text" placeholder="Room Code" style="padding:10px;">
        <br><br>
        <button class="btn-join" onclick="joinRoom()">Join Game</button>
    </div>

    <div id="game" style="display:none">
        <div class="status-bar">
            <h2 id="current-card">Waiting for Players...</h2>
            <div id="penalty-zone"></div>
        </div>

        <div id="table-area">
            <div id="discard-pile"></div>
        </div>

        <hr style="opacity: 0.2; margin: 30px 0;">

        <h3>Your Hand</h3>
        <div id="hand"></div>
        
        <br>
        <button class="btn-draw" onclick="drawCard()">Draw Card / Skip</button>
        <button id="startBtn" onclick="startGame()" style="background:#3498db; color:white;">Start Game</button>
    </div>

    <div id="suitModal">
        <h3>Choose New Suit</h3>
        <button onclick="selectSuit('‚ô•')">‚ô• Hearts</button>
        <button onclick="selectSuit('‚ô¶')">‚ô¶ Diamonds</button>
        <button onclick="selectSuit('‚ô£')">‚ô£ Clubs</button>
        <button onclick="selectSuit('‚ô†')">‚ô† Spades</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRoom = "";
        let pendingAceIndex = null;

        function joinRoom() {
            const name = document.getElementById('nameInput').value;
            myRoom = document.getElementById('roomInput').value;
            if(!name || !myRoom) return alert("Fill in both boxes!");
            
            socket.emit('join-room', { roomId: myRoom, playerName: name });
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game').style.display = 'block';
        }

        function startGame() {
            socket.emit('start-game', myRoom);
            document.getElementById('startBtn').style.display = 'none';
        }

        socket.on('game-state', (room) => {
            const me = room.players.find(p => p.id === socket.id);
            if(!me) return;

            // Update Current Card on Table
            document.getElementById('current-card').innerText = `Board: ${room.currentRank} of ${room.currentSuit}`;
            
            // Show Penalties (2s and Jack of Spades)
            const penaltyZone = document.getElementById('penalty-zone');
            penaltyZone.innerHTML = room.drawPenalty > 0 ? 
                `<p class="penalty-glow">‚ö†Ô∏è PENALTY ACTIVE: DRAW ${room.drawPenalty} ‚ö†Ô∏è</p>` : "";

            // Display your cards
            const handDiv = document.getElementById('hand');
            handDiv.innerHTML = '';
            me.hand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = `card ${['‚ô•','‚ô¶'].includes(card.suit) ? 'red' : ''}`;
                cardEl.innerHTML = `<span>${card.rank}</span><br><span>${card.suit}</span>`;
                
                cardEl.onclick = () => {
                    if(card.rank === 'A') {
                        pendingAceIndex = index;
                        document.getElementById('suitModal').style.display = 'block';
                    } else {
                        socket.emit('play-card', { roomId: myRoom, cardIndex: index });
                    }
                };
                handDiv.appendChild(cardEl);
            });
        });

        function selectSuit(suit) {
            socket.emit('play-card', { roomId: myRoom, cardIndex: pendingAceIndex, chosenSuit: suit });
            document.getElementById('suitModal').style.display = 'none';
        }

        function drawCard() {
            socket.emit('draw-card', myRoom);
        }
    </script>
</body>
</html>
